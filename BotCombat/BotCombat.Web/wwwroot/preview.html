<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script>

        var map = { height: 640, width: 640, scale: 32 };

        function getRandomInt()
        {
            return Math.floor(Math.random() * 20) * map.scale;
        }

        function getRandomDirection()
        {
            return Math.floor(Math.random() * 5);
        }

        function moveBot(b) {
            let b2 = { x: b.x, y: b.y, i: b.i };
            const max = map.scale * 19;
            const d = getRandomDirection();
            switch (d) {
                case 0:
                    b2.x = b.x + map.scale;
                    if (b2.x > max) b2.x = max;
                    break;
                case 1:
                    b2.x = b.x - map.scale;
                    if (b2.x < 0) b2.x = 0;
                    break;
                case 2:
                    b2.y = b.y + map.scale;
                    if (b2.y > max) b2.y = max;
                    break;
                case 3:
                    b2.y = b.y - map.scale;
                    if (b2.y < 0) b2.y = 0;
                    break;
            }

            return b2;
        }

        var walls = [];
        for (let i = 0; i < 100; i++) {
            let w = { x: getRandomInt(), y: getRandomInt() };
            walls.push(w);
        }

        var bonuses = [];
        for (let i = 0; i < 10; i++) {
            let b = { x: getRandomInt(), y: getRandomInt() };
            bonuses.push(b);
        }


        var steps = [{
                map: map,
                walls: walls,
                bonuses: bonuses,
                bots: [
                    { x: getRandomInt(), y: getRandomInt(), i: 0 }, 
                    { x: getRandomInt(), y: getRandomInt(), i: 1 }, 
                    { x: getRandomInt(), y: getRandomInt(), i: 2 }, 
                    { x: getRandomInt(), y: getRandomInt(), i: 3 }
                ]
            }];

        for (let i = 0; i < 1000; i++) {
            let b = {
                map: map,
                walls: walls,
                bonuses: bonuses,
                bots: [
                    moveBot(steps[i].bots[0]), 
                    moveBot(steps[i].bots[1]), 
                    moveBot(steps[i].bots[2]), 
                    moveBot(steps[i].bots[3]) 
                ]
            };
            steps.push(b);
        }


        var stepNumber = 0;

        var bg = new Image();
        var wall = new Image();
        var bonus = new Image();
        var bots = [new Image(), new Image(), new Image(), new Image()];

        function init() {
            bg.src = 'img/bg.png';
            wall.src = 'img/wall.png';
            bonus.src = 'img/bonus.png';
            bots[0].src = 'img/bot1.png';
            bots[1].src = 'img/bot2.png';
            bots[2].src = 'img/bot3.png';
            bots[3].src = 'img/bot4.png';
            window.requestAnimationFrame(draw);
        }

        function draw() {

            const step = steps[stepNumber];
            
            const ctx = document.getElementById('canvas').getContext('2d');

            ctx.globalCompositeOperation = 'destination-over';
            ctx.clearRect(0, 0, step.map.width, step.map.height);

            for (let i = 0; i < step.bots.length; i++) {
                const bt = step.bots[i];
                ctx.drawImage(bots[bt.i], bt.x, bt.y, step.map.scale, step.map.scale);
            }
            
            for (let i = 0; i < step.bonuses.length; i++) {
                const b = step.bonuses[i];
                ctx.drawImage(bonus, b.x, b.y, step.map.scale, step.map.scale);
            }

            for (let i = 0; i < step.walls.length; i++) {
                const w = step.walls[i];
                ctx.drawImage(wall, w.x, w.y, step.map.scale, step.map.scale);
            }

            ctx.drawImage(bg, 0, 0, step.map.width, step.map.height);

            stepNumber++;
            if (stepNumber >= steps.length) return;

            setTimeout('window.requestAnimationFrame(draw);', 100);

        }

        init();

    </script>
</head>
<body>
    <canvas id="canvas" width="640" height="640"></canvas>
</body>
</html>